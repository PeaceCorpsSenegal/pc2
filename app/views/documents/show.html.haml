.container
  .row
    .span-5
      = render 'shared/menu'
    .span-15
      .box
        %h1
          = @document.name
          .tags.right.inline= render 'shared/tags', :tags => @document.tag_list
        %p= @document.description
        %p= @document.language.name if @document.language
        %p
          = link_to 'download', download_document_path(@document) if can? :read, @document
          = mime_icon(@document.file_content_type)
          = @document.file_content_type
      .box
        .libraries{:style => (@document.stacks.any? ? nil : 'display:none;')}
          %h3 Libraries
          %ul
          - if @document.stacks.any?
            - @document.stacks.each do |s|
              %li
                = button_to 'remove', s, :confirm => 'Are you sure?', :method => :delete, :remote => true, :disable_with => 'please wait...' if can? :destroy, s
                = link_to s.library.name, s.library if s.id
                .clearfloat
        - if can? :create, Stack
          %h3 Add to a library
          - if current_user.libraries.any?
            - @stack = @document.stacks.build
            = form_for @stack, :remote => true do |f|
              = render 'shared/form_error' if @stack.errors.any?
              = f.hidden_field(:stackable_id)
              = f.hidden_field(:stackable_type)
              .field
                = f.collection_select(:library_id, current_user.libraries.all, :id, :name)
              .actions
                = f.submit 'Add to library', :disable_with => 'adding...'
        - elsif can? :create, Library
          = link_to 'create a library', new_library_path
    .span-4.last
      = document_icon_for @document, :size => :small
      .box
        %h3 Top Document Tags
        = cloud_of_tags
      = render 'shared/right_user_menu'